<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Special Game for You</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&family=VT323&family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0a0a0a;
            --wall-color: #333;
            --path-color: #0a0a0a;
            --player-color: #ff4141;
            --goal-color: #41ffca;
            --text-color: #e0e0e0;
            --romantic-pink: #ff8a80;
            --romantic-gold: #ffd700;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Sarabun', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            text-align: center;
        }

        #game-container {
            border: 2px solid var(--wall-color);
            border-radius: 8px;
            padding: 10px;
            background-color: #111;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
            transition: opacity 0.5s ease-out;
        }

        h1 {
            font-family: 'VT323', monospace;
            font-size: 2rem;
            color: var(--player-color);
            margin-bottom: 5px;
            animation: fadeIn 2s;
        }

        p {
            margin-top: 0;
            font-size: 1rem;
            animation: fadeIn 2s;
        }

        canvas {
            background-color: var(--path-color);
            display: block;
            border-radius: 4px;
        }

        /* --- Romantic Overlay Styles --- */
        #message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 100;
            opacity: 0;
            transition: opacity 2s ease-in;
            overflow: hidden;
        }
        
        #message-content {
            transform: translateY(20px);
            opacity: 0;
            animation: fadeInUp 2s ease-out 1s forwards;
            text-align: center;
        }
        
        #birthday-message {
            font-family: 'Great Vibes', cursive;
            font-size: 5rem;
            font-weight: normal;
            color: var(--romantic-gold);
            text-shadow: 0 0 15px var(--romantic-gold), 0 0 25px var(--romantic-gold);
            margin: 0;
        }
        
        #love-message {
            font-size: 1.8rem;
            color: #eee;
            margin-top: 20px;
            font-weight: 400;
            letter-spacing: 1px;
        }
        
        #final-message {
            font-size: 1.5rem;
            color: #ddd;
            margin-top: 10px;
        }
        
        .heart-icon {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            animation: beat 1.5s infinite ease-in-out;
        }

        /* --- Animations --- */
        @keyframes beat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- Starfield Background --- */
        .stars {
            background: #000 url(https://www.transparenttextures.com/patterns/stardust.png);
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            display: block;
            z-index: -1;
        }
        .stars.stars1 { animation: move-twink-back 200s linear infinite; }
        .stars.stars2 { animation: move-twink-back 150s linear infinite; }
        .stars.stars3 { animation: move-twink-back 100s linear infinite; }

        @keyframes move-twink-back {
            from { background-position: 0 0; }
            to { background-position: -10000px 5000px; }
        }


        /* Glitch Effect */
        .glitch {
            animation: glitch-animation 0.5s infinite;
        }

        @keyframes glitch-animation {
            0% { transform: translate(0); }
            20% { transform: translate(-5px, 5px); }
            40% { transform: translate(-5px, -5px); }
            60% { transform: translate(5px, 5px); }
            80% { transform: translate(5px, -5px); }
            100% { transform: translate(0); }
        }
        
        .scanline {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient( to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(255,255,255,0.05) 50%, rgba(255,255,255,0) );
            background-size: 100% 4px;
            animation: scanline-animation 4s linear infinite;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes scanline-animation {
            from { background-position: 0 0; }
            to { background-position: 0 -100px; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Mobile controls */
        #mobile-controls {
            display: none;
            margin-top: 20px;
            user-select: none;
        }
        #mobile-controls button {
            background-color: #333; color: white; border: 1px solid #555; border-radius: 50%;
            width: 60px; height: 60px; margin: 5px; font-size: 24px; font-weight: bold;
        }
        #mobile-controls div { display: flex; justify-content: center; align-items: center; }

        @media (max-width: 768px) {
            #mobile-controls { display: block; }
            h1 { font-size: 1.5rem; }
            p { font-size: 0.9rem; }
            #birthday-message { font-size: 3rem; }
            #love-message { font-size: 1.2rem; }
            #final-message { font-size: 1rem; }
        }
    </style>
</head>
<body>
    <div class="scanline"></div>
    <div id="game-container">
        <h1 id="level-title">Level 1</h1>
        <p id="subtitle">Find the way out.</p>
        <canvas id="gameCanvas"></canvas>
    </div>
    
    <div id="mobile-controls">
        <div><button id="btn-up">▲</button></div>
        <div><button id="btn-left">◄</button><button id="btn-down">▼</button><button id="btn-right">►</button></div>
    </div>

    <div id="message-overlay">
        <div class="stars stars1"></div>
        <div class="stars stars2"></div>
        <div class="stars stars3"></div>
        <div id="message-content">
            <svg class="heart-icon" viewBox="0 0 24 24">
                <path fill="#ff4757" d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"/>
            </svg>
            <h2 id="birthday-message">Love You</h2>
            <!-- <p id="love-message">แด่คนพิเศษที่สุดในโลกของฉัน</p> -->
            <p id="final-message">❤️ รักพี่นะคะ ❤️</p>
        </div>
    </div>

    <script>
        // --- Game Setup ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const titleElement = document.getElementById('level-title');
        const subtitleElement = document.getElementById('subtitle');
        const messageOverlay = document.getElementById('message-overlay');

        const TILE_SIZE = 20;
        let currentLevel = 0;
        let player, goal;
        let gameEnded = false;

        // --- Maze Data (Unchanged) ---
        const levels = [
            // Level 1
            [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,0,0,1,0,0,0,1,0,0,0,0,0,1],[1,1,1,0,1,0,1,0,1,0,1,1,1,0,1],[1,0,0,0,0,0,1,0,0,0,0,0,1,0,1],[1,0,1,1,1,1,1,1,1,1,1,0,1,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,1,0,1],[1,1,1,1,1,0,1,1,1,0,1,0,1,0,1],[1,0,0,0,1,0,1,0,0,0,1,0,0,0,1],[1,0,1,0,1,0,1,0,1,1,1,1,1,0,1],[1,0,1,0,0,0,1,0,0,0,0,0,0,3,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
            // Level 2
            [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,1,0,0,0,1,0,0,0,1,0,0,0,1],[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],[1,0,0,0,1,0,0,0,1,0,0,0,1,0,1],[1,1,1,1,1,1,1,0,1,1,1,1,1,0,1],[1,0,0,0,0,0,1,0,0,0,0,0,0,0,1],[1,0,1,1,1,0,1,1,1,1,1,0,1,1,1],[1,0,1,0,0,0,0,0,0,0,1,0,0,3,1],[1,0,1,0,1,1,1,1,1,0,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
            // Level 3 (FIXED)
            [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,3,0,0,0,1,0,0,0,1,0,0,0,0,1],[1,1,0,1,0,1,0,1,0,1,0,1,1,0,1],[1,0,0,1,0,1,0,1,0,1,0,1,0,0,1],[1,0,1,1,0,1,0,1,0,1,0,1,1,0,1],[1,0,0,0,0,0,0,1,0,1,0,0,0,0,1],[1,1,1,1,1,1,0,1,0,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,1,1,1,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
            // Level 4
            [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,3,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]
        ];
        const levelSubtitles = ["Find the way out.","It's getting darker.","Don't look back.","Something is wrong..."];

        // --- Game Logic ---
        function loadLevel(levelIndex) {
            const levelData = levels[levelIndex];
            canvas.width = levelData[0].length * TILE_SIZE;
            canvas.height = levelData.length * TILE_SIZE;
            for (let y = 0; y < levelData.length; y++) {
                for (let x = 0; x < levelData[y].length; x++) {
                    if (levelData[y][x] === 2) player = { x: x, y: y };
                    else if (levelData[y][x] === 3) goal = { x: x, y: y };
                }
            }
            titleElement.textContent = `Level ${levelIndex + 1}`;
            subtitleElement.textContent = levelSubtitles[levelIndex];
            draw();
        }

        function draw() {
            if (gameEnded) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const levelData = levels[currentLevel];
            for (let y = 0; y < levelData.length; y++) {
                for (let x = 0; x < levelData[y].length; x++) {
                    if (levelData[y][x] === 1) {
                        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--wall-color');
                        ctx.fillRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
                    }
                }
            }
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--goal-color');
            ctx.fillRect(goal.x * TILE_SIZE, goal.y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--player-color');
            ctx.beginPath();
            ctx.arc(player.x * TILE_SIZE + TILE_SIZE / 2, player.y * TILE_SIZE + TILE_SIZE / 2, TILE_SIZE / 2.5, 0, Math.PI * 2);
            ctx.fill();
        }

        function movePlayer(dx, dy) {
            if (gameEnded) return;
            const nextX = player.x + dx;
            const nextY = player.y + dy;
            if (levels[currentLevel][nextY][nextX] !== 1) {
                player.x = nextX;
                player.y = nextY;
                checkWinCondition();
                draw();
            }
        }

        function checkWinCondition() {
            if (player.x === goal.x && player.y === goal.y) {
                if (currentLevel < levels.length - 1) {
                    currentLevel++;
                    loadLevel(currentLevel);
                } else {
                    triggerSurprise();
                }
            }
        }

        function triggerSurprise() {
            gameEnded = true;
            document.body.classList.add('glitch');
            subtitleElement.textContent = "W H A T ?";
            titleElement.textContent = "E R R O R";
            titleElement.style.color = 'red';

            let flashes = 0;
            const flashInterval = setInterval(() => {
                document.body.style.backgroundColor = flashes % 2 === 0 ? '#ff0000' : '#000';
                flashes++;
                if (flashes > 7) {
                    clearInterval(flashInterval);
                    document.body.style.backgroundColor = 'var(--bg-color)';
                    showBirthdayMessage();
                }
            }, 100);
        }

        function showBirthdayMessage() {
            const gameContainer = document.getElementById('game-container');
            const mobileControls = document.getElementById('mobile-controls');
            
            gameContainer.style.opacity = '0';
            mobileControls.style.opacity = '0';
            
            setTimeout(() => {
                gameContainer.style.display = 'none';
                mobileControls.style.display = 'none';
                document.body.classList.remove('glitch');
                
                messageOverlay.style.display = 'flex';
                setTimeout(() => {
                    messageOverlay.style.opacity = '1';
                }, 50);

            }, 500);
        }

        // --- Event Listeners ---
        window.addEventListener('keydown', (e) => {
            switch (e.key) {
                case 'ArrowUp': case 'w': movePlayer(0, -1); break;
                case 'ArrowDown': case 's': movePlayer(0, 1); break;
                case 'ArrowLeft': case 'a': movePlayer(-1, 0); break;
                case 'ArrowRight': case 'd': movePlayer(1, 0); break;
            }
        });
        document.getElementById('btn-up').addEventListener('click', () => movePlayer(0, -1));
        document.getElementById('btn-down').addEventListener('click', () => movePlayer(0, 1));
        document.getElementById('btn-left').addEventListener('click', () => movePlayer(-1, 0));
        document.getElementById('btn-right').addEventListener('click', () => movePlayer(1, 0));

        // --- Initial Load ---
        window.onload = () => {
            loadLevel(currentLevel);
        };
    </script>
</body>
</html>

